# ç•Œé¢åŠŸèƒ½æ›´æ–°è¯´æ˜ - 2025å¹´11æœˆ6æ—¥

## ğŸ“± æœ¬æ¬¡æ›´æ–°å†…å®¹

### 1. åº”ç”¨æ ‡é¢˜æ›´æ”¹
```
åŸ: NFC è¯»å†™ç³»ç»Ÿ
æ–°: åŠ æ²¹åˆ·å¡æ¶ˆè´¹
```

### 2. å­—æ®µåç§°ä¿®æ”¹

| åŸåç§° | æ–°åç§° | è¾“å…¥ç±»å‹ | å˜åŒ–è¯´æ˜ |
|--------|--------|----------|----------|
| å¡å· | å¡å· | **EditText â†’ TextView** | æ”¹ä¸ºåªè¯»ï¼Œè¯»å¡åè‡ªåŠ¨å¡«å…… |
| è½¦å· | æœºå· | EditText | ä¿æŒå¯è¾“å…¥ |
| é‡‘é¢ | æ¶ˆè´¹é‡‘é¢ | EditText | ä¿æŒå¯è¾“å…¥ |

### 3. å¡å·å­—æ®µé‡å¤§å˜åŒ– â­

#### ä¹‹å‰çš„è¡Œä¸º
- âœï¸ EditText å¯æ‰‹åŠ¨è¾“å…¥
- æç¤º: "è¯·è¾“å…¥å¡å·"
- ç”¨æˆ·å¯ä»¥éšæ„è¾“å…¥ä»»ä½•å¡å·

#### ç°åœ¨çš„è¡Œä¸º
- ğŸ“‹ TextView åªè¯»æ ‡ç­¾ï¼ˆä¸å¯ç¼–è¾‘ï¼‰
- æç¤º: "è¯·å…ˆè¯»å¡"
- **å¿…é¡»é€šè¿‡ç‚¹å‡»"è¯»å–"æŒ‰é’®ä»NFCæ ‡ç­¾è¯»å–**
- è‡ªåŠ¨å¡«å……ï¼Œæ— æ³•æ‰‹åŠ¨ä¿®æ”¹

#### è¯»å¡æ“ä½œæµç¨‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç‚¹å‡»è¯»å–æŒ‰é’® â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. é è¿‘NFCæ ‡ç­¾  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è‡ªåŠ¨è¯»å–å¡å· â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å¡«å……åˆ°ç•Œé¢   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æç¤ºè¯»å¡æˆåŠŸ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. æ‰“å°å°ç¥¨æ ¼å¼æ›´æ–°

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      æ¶ˆè´¹å°ç¥¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¡å·: 1234567890123456

æœºå·: 1

æ¶ˆè´¹é‡‘é¢: 100.50 å…ƒ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ—¶é—´: 2025-11-06 14:30:25
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      è°¢è°¢æƒ é¡¾ï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### 5. æç¤ºä¿¡æ¯æ›´æ–°

| éªŒè¯åœºæ™¯ | åŸæç¤º | æ–°æç¤º |
|----------|--------|--------|
| å¡å·ä¸ºç©º | "è¯·è¾“å…¥å¡å·" | **"è¯·å…ˆè¯»å¡"** |
| æœºå·ä¸ºç©º | "è¯·è¾“å…¥è½¦å·" | **"è¯·è¾“å…¥æœºå·"** |
| é‡‘é¢ä¸ºç©º | "è¯·è¾“å…¥é‡‘é¢" | **"è¯·è¾“å…¥æ¶ˆè´¹é‡‘é¢"** |

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°ç»†èŠ‚

### å¸ƒå±€æ–‡ä»¶ (activity_main.xml)

**1. æ ‡é¢˜ä¿®æ”¹**
```xml
<TextView
    android:text="åŠ æ²¹åˆ·å¡æ¶ˆè´¹"
    android:textSize="24sp"
    android:textStyle="bold"
    android:textAlignment="center" />
```

**2. å¡å·æ”¹ä¸ºåªè¯»Label**
```xml
<!-- ä» EditText æ”¹ä¸º TextView -->
<TextView
    android:id="@+id/et_card_number"
    android:layout_width="match_parent"
    android:layout_height="50dp"
    android:hint="è¯·å…ˆè¯»å¡"
    android:text=""
    android:textColor="#333333"
    android:gravity="center_vertical"
    android:background="@android:color/white"
    android:paddingLeft="16dp"
    android:paddingRight="16dp" />
```

**3. å­—æ®µæ ‡ç­¾æ›´æ–°**
```xml
<TextView android:text="æœºå·" />      <!-- åŸ: è½¦å· -->
<TextView android:text="æ¶ˆè´¹é‡‘é¢" />  <!-- åŸ: é‡‘é¢ -->
```

### ä¸»Activity (MainActivity.kt)

**1. å˜é‡ç±»å‹æ›´æ”¹**
```kotlin
// åŸæ¥
val etCardNumber = findViewById<EditText>(getResId("et_card_number", "id"))

// ç°åœ¨
val etCardNumber = findViewById<TextView>(getResId("et_card_number", "id"))
```

**2. è¯»å–æŒ‰é’®é€»è¾‘**
```kotlin
btnRead.setOnClickListener {
    // TODO: å®é™…åº”è¯¥ä»NFCæ ‡ç­¾è¯»å–
    val mockCardNumber = "1234567890123456"
    
    // è‡ªåŠ¨å¡«å……å¡å·
    etCardNumber.text = mockCardNumber
    
    // æ›´æ–°NFCIDæ˜¾ç¤º
    tvNfcid.text = "NFCID: ${mockCardNumber.substring(0, 8)}"
    
    // æ˜¾ç¤ºæˆåŠŸæç¤º
    Toast.makeText(this, 
        "ğŸ“– è¯»å¡æˆåŠŸï¼å¡å·: $mockCardNumber", 
        Toast.LENGTH_SHORT).show()
}
```

**3. éªŒè¯é€»è¾‘æ›´æ–°**
```kotlin
private fun handlePrint(etCardNumber: TextView, ...) {
    val cardNumber = etCardNumber.text.toString().trim()
    
    // æ£€æŸ¥æ˜¯å¦å·²è¯»å¡
    if (cardNumber.isEmpty() || cardNumber == "è¯·å…ˆè¯»å¡") {
        Toast.makeText(this, "è¯·å…ˆè¯»å¡", Toast.LENGTH_SHORT).show()
        return
    }
    
    // å…¶ä»–éªŒè¯...
}
```

### æ‰“å°æ¨¡å— (BluetoothPrinter.kt)

**å°ç¥¨æ ‡ç­¾æ›´æ–°**
```kotlin
fun printReceipt(cardNumber: String, carNumber: String, amount: String): Boolean {
    try {
        // ... åˆå§‹åŒ– ...
        
        // æ‰“å°æœºå·ï¼ˆåŸè½¦å·ï¼‰
        outputStream.write("æœºå·: ".toByteArray(Charset.forName("GBK")))
        outputStream.write(carNumber.toByteArray())
        
        // æ‰“å°æ¶ˆè´¹é‡‘é¢ï¼ˆåŸé‡‘é¢ï¼‰
        outputStream.write("æ¶ˆè´¹é‡‘é¢: ".toByteArray(Charset.forName("GBK")))
        outputStream.write(amount.toByteArray())
        outputStream.write(" å…ƒ".toByteArray(Charset.forName("GBK")))
        
        // ...
    }
}
```

---

## ğŸ“¦ å®‰è£…éƒ¨ç½²

### ç¼–è¯‘ç»“æœ
```
âœ… BUILD SUCCESSFUL in 41s
36 actionable tasks: 13 executed, 23 up-to-date
```

### APKä½ç½®
```
K:\NFC\NFCApp\app\build\outputs\apk\debug\app-debug.apk
```

### å®‰è£…å‘½ä»¤
åœ¨ç‰©ç†ä¸»æœºä¸Šæ‰§è¡Œ:
```powershell
K:\tool\adb\adb.exe install -r K:\NFC\NFCApp\app\build\outputs\apk\debug\app-debug.apk
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### å®Œæ•´æ“ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ‰“å¼€åº”ç”¨                  â”‚
â”‚    - è“ç‰™è‡ªåŠ¨å¯ç”¨            â”‚
â”‚    - ç•Œé¢æ˜¾ç¤º"è¯·å…ˆè¯»å¡"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ç‚¹å‡»"è¯»å–"æŒ‰é’®            â”‚
â”‚    - æ‰‹æœºé è¿‘NFCæ ‡ç­¾         â”‚
â”‚    - è‡ªåŠ¨è¯»å–å¡å·            â”‚
â”‚    - å¡å·æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è¾“å…¥æœºå·                  â”‚
â”‚    - é»˜è®¤å€¼: 1               â”‚
â”‚    - å¯æ‰‹åŠ¨ä¿®æ”¹              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è¾“å…¥æ¶ˆè´¹é‡‘é¢              â”‚
â”‚    - æ”¯æŒå°æ•°ï¼ˆå¦‚100.50ï¼‰    â”‚
â”‚    - å¿…å¡«é¡¹                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç‚¹å‡»"æ‰“å°"æŒ‰é’®            â”‚
â”‚    - è¿æ¥è“ç‰™æ‰“å°æœº          â”‚
â”‚    - æ‰“å°æ¶ˆè´¹å°ç¥¨            â”‚
â”‚    - æ˜¾ç¤ºæ‰“å°ç»“æœ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦æé†’**:
1. **å¡å·æ— æ³•æ‰‹åŠ¨è¾“å…¥** - å¿…é¡»é€šè¿‡è¯»å¡è·å–
2. **æœªè¯»å¡ç¦æ­¢æ‰“å°** - ç‚¹å‡»æ‰“å°ä¼šæç¤º"è¯·å…ˆè¯»å¡"
3. **æœºå·å¯ä»¥ä¿®æ”¹** - é»˜è®¤å€¼ä¸º1ï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´
4. **é‡‘é¢æ”¯æŒå°æ•°** - è¾“å…¥ç±»å‹ä¸ºnumberDecimal

âœ… **æœ€ä½³å®è·µ**:
- å…ˆè¯»å¡ï¼Œå†è¾“å…¥å…¶ä»–ä¿¡æ¯
- ç¡®è®¤ä¿¡æ¯æ— è¯¯åå†æ‰“å°
- ä¿æŒæ‰‹æœºè“ç‰™å¼€å¯
- æ‰“å°æœºä¿æŒç”µé‡å……è¶³

---

## ğŸ”® åç»­æ”¹è¿›å»ºè®®

### 1. NFCçœŸå®è¯»å–å®ç°

å½“å‰è¯»å¡åŠŸèƒ½ä¸ºæ¨¡æ‹Ÿå®ç°ï¼ˆå›ºå®šè¿”å› `1234567890123456`ï¼‰

**çœŸå®NFCå®ç°ç¤ºä¾‹**:
```kotlin
override fun onNewIntent(intent: Intent?) {
    super.onNewIntent(intent)
    
    if (NfcAdapter.ACTION_TAG_DISCOVERED == intent?.action) {
        val tag: Tag? = intent.getParcelableExtra(NfcAdapter.EXTRA_TAG)
        val tagId = tag?.id
        
        // å°†å­—èŠ‚æ•°ç»„è½¬ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²
        val cardNumber = tagId?.joinToString("") { 
            String.format("%02X", it) 
        } ?: "æœªçŸ¥å¡å·"
        
        // æ›´æ–°ç•Œé¢
        etCardNumber.text = cardNumber
        tvNfcid.text = "NFCID: ${cardNumber.take(8)}"
        
        Toast.makeText(this, "è¯»å¡æˆåŠŸï¼", Toast.LENGTH_SHORT).show()
    }
}
```

### 2. å¡å·æ ¼å¼åŒ–æ˜¾ç¤º

å»ºè®®å¯¹é•¿å¡å·è¿›è¡Œåˆ†æ®µæ˜¾ç¤ºï¼Œæå‡å¯è¯»æ€§:
```kotlin
// æ¯4ä½åŠ ä¸€ä¸ªç©ºæ ¼
fun formatCardNumber(cardNumber: String): String {
    return cardNumber.chunked(4).joinToString(" ")
}

// æ˜¾ç¤º: 1234 5678 9012 3456
```

### 3. å†å²è®°å½•å…³è”

å°†è¯»å¡è®°å½•ä¸æ‰“å°è®°å½•å…³è”:
```kotlin
data class PrintRecord(
    val cardNumber: String,
    val machineNumber: String,
    val amount: Double,
    val timestamp: Long,
    val nfcTagId: String  // å…³è”NFCæ ‡ç­¾ID
)
```

---

## ğŸ“Š æ›´æ–°å¯¹æ¯”æ€»ç»“

| åŠŸèƒ½ç‚¹ | æ›´æ–°å‰ | æ›´æ–°å |
|--------|--------|--------|
| åº”ç”¨åç§° | NFC è¯»å†™ç³»ç»Ÿ | **åŠ æ²¹åˆ·å¡æ¶ˆè´¹** |
| å¡å·è¾“å…¥ | å¯æ‰‹åŠ¨è¾“å…¥ | **åªèƒ½è¯»å¡è·å–** |
| è½¦å·å­—æ®µ | è½¦å· | **æœºå·** |
| é‡‘é¢å­—æ®µ | é‡‘é¢ | **æ¶ˆè´¹é‡‘é¢** |
| å°ç¥¨æ ‡é¢˜ | åœè½¦ç¼´è´¹å°ç¥¨ â†’ æ¶ˆè´¹å°ç¥¨ | **æ¶ˆè´¹å°ç¥¨** |
| æ‰“å°å†…å®¹ | è½¦å·ã€é‡‘é¢ | **æœºå·ã€æ¶ˆè´¹é‡‘é¢** |

---

**æ›´æ–°å®Œæˆæ—¶é—´**: 2025å¹´11æœˆ6æ—¥  
**ç¼–è¯‘çŠ¶æ€**: âœ… BUILD SUCCESSFUL  
**æµ‹è¯•çŠ¶æ€**: å¾…ç‰©ç†è®¾å¤‡æµ‹è¯•

